# Модель вентильного электродвигателя
Данная работа моделирует работу трёхполюсного вентильного электродвигателя.

Навигация по файлу:

+ [Параметры модели](#Param)
+ [Запуск модели](#Play)
+ [Принцип работы](#How_to)
+ [Литература](#Literature)
+ [Вопросы](#Questions)

## <a id="Param">Параметры</a>
В модели используется три ".m" файла для задания параметров системы:
- parameters.m
- engine_model_param.m
- angular_position_sensor_param.m
 
Они нужны для определения начальных параметров всей системы. Далее описано их содержание и значение параметров.

### "parameters.m"

В этом файле описаны пользовательские параметры, которые можно изменять.

- *duty_cycle* — [ % ; 0 < *duty_cycle* < 100 ]  Скважность ШИМ. Изменяя его, регулируется скорость вращения ротора.
- *f_PWM* — частота ШИМ. Не рекомендуется изменять. Рассчитана из логических соображений (частота ШИМа много больше максимальной частоты вращения ротора ~ 4000 об/мин).
- *T_PWM* - период ШИМ.

### "engine_model_param.m"

В этом файле описаны технические характеристики электродвигателя. В качестве примера используется электродвигатель **АТ 68 14 Т** производства компании *"Андроидная Техника"*.

- *p* \[ шт \] — число пар полюсов
- *V_n* \[ В \] — номинальное напряжение
- *T_n* \[ Нм \] — номинальный крутящий момент
- *I_n* \[ А \] — номинальный ток
- *K_t* \[ Нм/А \] — постоянная момента
- *rotation_speed* \[ об/с \] — скорость вращения (без нагрузки)
- *D* \[ м \] — диаметр статора
- *d* \[ м \] — внутренний диаметр ротора
- *m* \[ кг \] — вес электродвигателя
- *J_r* \[кг $\cdot$ м $^2$\] — момент инерции электродвигателя
- *J* \[ кг $\cdot$ м $^2$ \] — дополнительный момент инерции

### "angular_position_sensor_param.m"

В этом файле описаны технические характеристики датчика углового положения. В качестве примера используются параметры датчика **IRS-I80U4S1-18-5B3** производства компании *Lenz Encoders*.

- *f_update* \[ Гц \] — частота обновления кода
- *T_update* \[ с \] — время обновления кода
- *bit_depth* — разрядность

## <a id="Play">Запуск модели</a>

В командном окне *MATLAB* в папке с моделью запустите скрипт *"parameters.m"*

```
parameters
```

Далее задайте скважность ШИМ от 0 до 100 (по умолчанию 99), также можно задать дополнительную нагрузку на двигатель *J*:

```
duty_cycle = *value*
J = *value*
```
Затем запустите модель *"model.slx"*

```
model
```

В блоке *Scope* вы можете видеть зависимость угловой скорости (об/мин) от времени.

## <a id="How_to">Принцип работы</a>

Модель электродвигателя имеет один вход и один выход. На вход системы подаётся модулированный сигнал. Важна не его амплитуда, а скважность. Скважностью можно регулировать суммарную мощность, подаваемую на двигатель. На выходе системы вы получаете угловую скорость в об/с. Для читаемости, на *Scope* выведен сигнал в об/мин.

Модель вентильного электродвигателя состоит из 4 составляющих: [генератор](#generator) (*generator*), [контроллер](#controller) (*controller*), сам [двигатель](#engine) (*valve_engine*) и [датчик углового положения](#sensor) (*angular_position_sensor*).

+  Генератор вход получает ШИМ сигнал и в то время, когда сигнал не нулевой, он выдаёт номинальное напряжение, на котором работает электродвигатель.
+  Датчик углового положения передаёт информацию о положении двигателя на контроллер.
+  Контроллер, в зависимости от угла поворота электродвигателя подаёт получаемое напряжение на его фазы таким образом, чтобы в каждый момент времени обмотки катушек создавали положительный крутящий момент.

### <a id="generator">Генератор</a>

Преобразует данное напряжение в 12 В в номинальное для двигателя и подаёт на вход тогда, когда сигнал на входе больше нуля.

### <a id="controller">Контроллер</a>

Состоит из 3 подсистем. Подсистема контролирует подачу напряжения на соответствующую фазу таким образом, чтобы обмотка фазы создавала положительный крутящий момент. Далее приведена таблица расположения фаз двигателя и подача на них напряжения в зависимости от угла поворота электродвигателя. (Все значения указаны по модулю
$\frac{2 \pi}{p}$
так как двигатель имеет осевую симметрию с таким периодом)

<table>
  <tr>
	<th></th>
	<th>Фаза 1</th>
	<th>Фазы 2</th>
	<th>Фаза 2</th>
  </tr>
  <tr>
	<td>Положение</td>
	<td>$-\frac{\pi}{3p}$ ÷ $\frac{\pi}{3p}$</td>
	<td>$\frac{\pi}{3p}$ ÷ $\pi$</td>
	<td>$\pi$ ÷ $\frac{5\pi}{3p}$</td>
  </tr>
  <tr>
	<td>Включение</td>
	<td>$\frac{\pi}{p}$ ÷ $\frac{2\pi}{p}$</td>
	<td>$-\frac{\pi}{3p}$ ÷ $\frac{2\pi}{3p}$</td>
	<td>$\frac{\pi}{3p}$ ÷ $\frac{4\pi}{3p}$</td>
  </tr>
</table>

Настройку начального положения электродвигателя нужно провести следующим образом: в течении характерного времени затухания подаль постоянное напряжение на фазу 1, от чего двигатель притянется к обмоткам первой фазы и встанет в нулевое угловое положение.

### <a id="engine">Двигатель</a>

Модель электродвигателя состоит из двух подсистем: [электромагнитного поля](#field)(*electromagnetic_field*) и [ротора](#rotor)(*rotor*). В зависимости от напряжения на определённых фазах и в зависимости от положения ротора двигатель создаёт конкретный крутящий момент. Момент раскручивает ротор, который вращается с определённой скоростью.

#### Электромагнитное поле

Модель электромагнитного поля состоит из трёх подсистем, каждая из которых определяет силу от каждой обмотки, а далее суммарное действие на ротор отправляет на выход системы.

Так как энергия магнитного поля определяется по формуле "
$-(\overline{m} \cdot \overline{B})$
", то крутящий момент пропорционален синусу угла между полем и ротором. Также момент пропорционален входному току. Ещё учитывая периодичность системы с периодом
$\frac{2\pi}{pairs}$
получим конечную формулу для крутящего момента (
$\phi$
— угол между полем и ротором, считая от положения равновесия по модулю
$\frac{2\pi}{pairs}$:

$F = \frac{U}{U_n} \cdot I_n K_t \cdot \sin(pairs \cdot \phi)$
#### Ротор

Движение ротора описывается следующим уравнением (V — угловая скорость, F — крутящий момент):

$\ddot V = (F - F_{drag})/(J + J_r)$

где
$J_r = m\frac{d^2+D^2}{8}$

Из уравнение Ньютона для вязких сред можно показать, что
$F_{drag} \sim V$. Отсюда и составляется модель ротора.

### <a id="sensor">Датчик углового положения</a>

Считывает положение ротора с частотой дискретизации *f_update* и отправляет полученные данные контроллеру.

## <a id="Literature">Литература</a>

При разработке пользовался следующей литературой:
- [Принцип работы](https://www.youtube.com/watch?v=QmCZ0L_yvTI) бесколлекторного вентильного двигателя
- [Документация](https://www.mathworks.com/help/simulink/index.html?s_tid=hc_panel) по работе с *Matlab/simulink*
- [Описание](https://innodrive.ru/catalog/npoat/motor/21140/) электродвигателя *AT Drive 68x14T*
- [Техническое описание](https://lenzencoders.com/datasheets/IRS-encoders_ru_RU.pdf) абсолютных эндокоров угла встраиваемой конструкции

## <a id="Questions">Возникшие вопросы</a>

При разработке возникли вопросы разного характера:
1. Как смоделировать датчик углового положения?
  - При разработке возникла идея реализовать модель на основе АЦП с разрядностью *bit_depth* = 18 бит и частотой дискретизации *f_update* = 71.4 кГц, но к сожалению не нашёл подходящего для этого АЦП в *Matlab*.
3. Как и где можно было бы учесть наличие шумов в системе?
4. Можно ли в *Matlab* динамически менять параметры во время выполнения моделирования, например скважность ШИМ, а не каждый раз компилировать программу с новыми данными?
5. Есть ли иные факторы, влияющие на угловое вращение ротора, кроме силы вязкого трения?
